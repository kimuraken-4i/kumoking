<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CloudShape</title>
    <link rel="stylesheet" type="text/css" href="{{url_for('static',filename='css/style.css')}}">
    <script>
        
    </script>
</head>
<body>
    <header>   
        <a class="header-logo">雲判別（6分類）</a>
    </header>

    <div class="main">    
        <h2> 選択された画像の雲の形をざっくりと識別します</h2>
        <p>画像を選択して送信してください</p>
        <!--
        <br>
        <p>【線状の雲＜巻雲：すじ雲＞】</p>
        <p>【粒々の雲＜巻積雲：うろこ雲、高積雲：ひつじ雲＞】</p>
        <p>【もくもくとした雲＜積乱雲：入道雲＞】</p>
        <p>【ふわっとした雲＜積雲：わた雲＞】</p>
        <p>【うろこ状の雲＜巻積雲：うろこ雲・いわし雲＞】</p>
        <p>【霧状の雲＜積雲：きり雲＞】</p>
        <br>
        -->
        <div id="mission"></div>
        <form method="POST" id="form" enctype="multipart/form-data">
            <input class="file_choose" type="file" name="file">
            <input class="btn" id="btn" value="! 判定 !" type="button" onclick="sent();">
        </form>
        <div id="response"></div>
        <img src="{{ image_path }}" alt="関連ポケモンの画像">
        <!-- <img src="./static/images/マッギョ.png" alt="no pictures found"> -->
        
    </div>
    <footer>
        <small>2022 h.s</small>   
    </footer>
    <script>
        //属性をランダムで選出
        const attributes=[
            "ほのお","みず","くさ","かみなり","ノーマル","エスパー","ドラゴン","はがね","かくとう"
        ];
        function judge(attribute){
            //属性で勝敗を判断する関数
        }
        const myAttributes={
            "バチンキー":"草",//1
            "ドラパルト":"エスパー",
            "ドータクン":"鋼",
            "カラサリス":"草",
            "マッギョ":"電気",//5
            "マクノシタ":"かくとう",
            "マッスグマ":"ノーマル",
            "モンメン":"草",
            "ピッピ":"エスパー",
            "プロトーガ":"水",//10
            "ランドロス":"かくとう",
            "レックウザ":"ドラゴン",
            "サンダー":"電気",
            "ビクティニ":"炎",
            "ヨワシ":"水"//15
        };
        var resJson;

        async function sent(){
            const form = document.getElementById("form");
            const formData = new FormData(form);
            try{
                const response = await fetch("/",{
                    method:"POST",
                    body: formData
                });
                if (!response.ok) {
                    throw new Error(`レスポンスステータス: ${response.status}`);
                }
                resJson = await response.json();
                console.log("calling")
                console.log(resJson);
                console.log("called")

                //ポケモンの属性を抽出
                const curPokeAttribute=myAttributes[resJson.poke_answer];
                //HTML要素を生成
                //resJson=JSON.parse(json);
                document.getElementById('response').innerHTML = `
                        <p>これは 【 ${resJson.cloud_answer} 雲 】 です</p>
                        <p>一番似ているポケモンは 【 ${resJson.poke_answer} 】 で
                        【 ${curPokeAttribute} 】属性です</p>
                        <img src="${resJson.image_path}" alt="関連ポケモンの画像">
                `;
            }catch(error){
                console.log("エラー");
            }
        }

        //画像が送信されたら呼ばれる関数
        console.log("start");

        const randomAttribute=attributes[Math.floor(Math.random()*(attributes.length))];
        document.getElementById("mission").textContent=`${randomAttribute}タイプのポケモンに似た雲の写真を撮ろう！`;

    </script>
</body>
</html>